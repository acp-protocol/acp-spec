# ACP CLI Directive Audit Report

<!--
This report is generated by /acp.cli-audit-directives.
It tracks RFC-001 compliance status for the CLI implementation.
-->

**Generated**: [TIMESTAMP]
**CLI Version**: [CLI_VERSION]
**RFC Reference**: RFC-001 (Self-Documenting Annotations)
**Status**: [PASS|FINDINGS|BLOCKERS]

---

## Executive Summary

| Category   | Count     | Description                   |
|------------|-----------|-------------------------------|
| Blockers   | [B_COUNT] | MUST implement before release |
| Violations | [V_COUNT] | SHOULD implement              |
| Warnings   | [W_COUNT] | MAY implement                 |

**Overall Assessment**: [ASSESSMENT_TEXT]

---

## Feature Coverage

| Feature           | Status   | Implementation Gap  |
|-------------------|----------|---------------------|
| Directive Parsing | [STATUS] | [GAP_DESCRIPTION]   |
| Directive Storage | [STATUS] | [GAP_DESCRIPTION]   |
| Symbol Indexing   | [STATUS] | [GAP_DESCRIPTION]   |
| Inline Tracking   | [STATUS] | [GAP_DESCRIPTION]   |
| Map Command       | [STATUS] | [GAP_DESCRIPTION]   |
| Migrate Command   | [STATUS] | [GAP_DESCRIPTION]   |
| Constraint Output | [STATUS] | [GAP_DESCRIPTION]   |

**Status Legend**: ○ Missing | ◐ Partial | ● Complete

---

## Module Analysis

### Parser Module (`cli/src/parse/`)

| Task ID  | Requirement                             | Status   | Notes  |
|----------|-----------------------------------------|----------|--------|
| P01      | Annotation struct has `directive` field | [STATUS] |        |
| P02      | Regex extracts directive suffix         | [STATUS] |        |
| P03      | `auto_generated` flag support           | [STATUS] |        |
| P04      | Multi-line directive handling           | [STATUS] |        |
| P05      | Default directive generation            | [STATUS] |        |
| P06      | Symbol annotation parsing               | [STATUS] |        |
| P07      | Inline annotation parsing               | [STATUS] |        |

**Current Implementation**:
```rust
// Current Annotation struct
[CURRENT_CODE]
```

**Required Changes**:
```rust
// Required Annotation struct
[REQUIRED_CODE]
```

---

### Cache Module (`cli/src/cache/`)

| Task ID   | Requirement                          | Status   | Notes   |
|-----------|--------------------------------------|----------|---------|
| C01       | FileEntry has `purpose` field        | [STATUS] |         |
| C02       | FileEntry has `symbols` array        | [STATUS] |         |
| C03       | FileEntry has `inline` array         | [STATUS] |         |
| C04       | SymbolAnnotation type defined        | [STATUS] |         |
| C05       | InlineAnnotation type defined        | [STATUS] |         |
| C06       | LineRange type defined               | [STATUS] |         |
| C07       | Annotation has `directive` field     | [STATUS] |         |
| C08       | Annotation has `auto_generated` flag | [STATUS] |         |

**Schema Alignment**:
- Cache schema updated: [YES/NO]
- New fields in schema: [LIST]

---

### Constraints Module (`cli/src/constraints/`)

| Task ID   | Requirement                    | Status   | Notes   |
|-----------|--------------------------------|----------|---------|
| N01       | Output includes directive text | [STATUS] |         |
| N02       | Directive aggregation logic    | [STATUS] |         |
| N03       | Conflict resolution (Q03)      | [STATUS] |         |

---

### Commands

| Task ID   | Command            | Requirement                      | Status   | Notes   |
|-----------|--------------------|----------------------------------|----------|---------|
| M01       | `acp map`          | Directory/file structure display | [STATUS] |         |
| M02       | `acp migrate`      | Add directive suffixes           | [STATUS] |         |
| M03       | `acp query file`   | Include purpose/symbols          | [STATUS] |         |
| M04       | `acp query symbol` | Include line ranges              | [STATUS] |         |
| M05       | `acp constraints`  | Show directives                  | [STATUS] |         |

---

### Indexer (`cli/src/index/`)

| Task ID   | Requirement                      | Status   | Notes   |
|-----------|----------------------------------|----------|---------|
| I01       | Warn on missing directives (Q07) | [STATUS] |         |
| I02       | Extract file purpose             | [STATUS] |         |
| I03       | Build symbol annotation index    | [STATUS] |         |
| I04       | Build inline annotation index    | [STATUS] |         |

---

## Detailed Findings

### Blockers (MUST Implement)

| ID    | Location    | Finding       | Remediation   |
|-------|-------------|---------------|---------------|
| [ID]  | [FILE:LINE] | [DESCRIPTION] | [FIX]         |

### Violations (SHOULD Implement)

| ID   | Location    | Finding       | Remediation  |
|------|-------------|---------------|--------------|
| [ID] | [FILE:LINE] | [DESCRIPTION] | [FIX]        |

### Warnings (MAY Implement)

| ID   | Location    | Finding       | Suggestion   |
|------|-------------|---------------|--------------|
| [ID] | [FILE:LINE] | [DESCRIPTION] | [SUGGESTION] |

---

## Implementation Tasks

### Priority 1 (Blockers)

| Task                      | Module   | Estimate   | Dependencies   |
|---------------------------|----------|------------|----------------|
| Update Annotation struct  | parse    | 1h         | None           |
| Update parser regex       | parse    | 2h         | P01            |
| Update FileEntry struct   | cache    | 2h         | None           |
| Implement map command     | commands | 4h         | Cache updates  |
| Implement migrate command | commands | 4h         | Parser updates |

### Priority 2 (Violations)

| Task                      | Module      | Estimate  | Dependencies   |
|---------------------------|-------------|-----------|----------------|
| Add multi-line support    | parse       | 2h        | P02            |
| Add SymbolAnnotation type | cache       | 2h        | None           |
| Update constraint output  | constraints | 2h        | Cache updates  |

### Priority 3 (Warnings)

| Task   | Module   | Estimate   | Dependencies  |
|--------|----------|------------|---------------|
| [TASK] | [MODULE] | [ESTIMATE] | [DEPS]        |

---

## Spec Decisions Applied

| Decision                    | Choice   | CLI Impact   |
|-----------------------------|----------|--------------|
| Q01 (Directive requirement) | [CHOICE] | [IMPACT]     |
| Q04 (Auto-generated format) | [CHOICE] | [IMPACT]     |
| Q07 (CLI warning behavior)  | [CHOICE] | [IMPACT]     |
| Q08 (Cache storage)         | [CHOICE] | [IMPACT]     |

---

## Test Coverage

### Existing Tests

| Test File                 | Coverage   | Status   |
|---------------------------|------------|----------|
| `cli/tests/parse_test.rs` | [COVERAGE] | [STATUS] |
| `cli/tests/cache_test.rs` | [COVERAGE] | [STATUS] |

### New Tests Required

| Test                            | Module   | Description                 |
|---------------------------------|----------|-----------------------------|
| `test_parse_directive`          | parse    | Verify directive extraction |
| `test_parse_multiline`          | parse    | Verify multi-line handling  |
| `test_auto_generated_directive` | parse    | Verify default generation   |
| `test_cache_symbol_annotations` | cache    | Verify symbol serialization |
| `test_cache_inline_annotations` | cache    | Verify inline serialization |
| `test_map_command`              | commands | Verify map output format    |
| `test_migrate_dry_run`          | commands | Verify migrate preview      |

---

## Next Steps

1. [ ] Review and approve this audit report
2. [ ] Run `/acp.cli-remediate` to implement changes
3. [ ] Run `/acp.cli-verify` to validate output
4. [ ] Update CLI tests
5. [ ] Update CLI documentation
6. [ ] Prepare release

---

## Appendix: File Inventory

### Files to Modify

| File                         | Changes Required    |
|------------------------------|---------------------|
| `cli/src/parse/mod.rs`       | [CHANGES]           |
| `cli/src/cache/types.rs`     | [CHANGES]           |
| `cli/src/constraints/mod.rs` | [CHANGES]           |
| `cli/src/index/indexer.rs`   | [CHANGES]           |
| `cli/src/commands/query.rs`  | [CHANGES]           |
| `cli/src/commands/check.rs`  | [CHANGES]           |

### Files to Create

| File                          | Purpose                        |
|-------------------------------|--------------------------------|
| `cli/src/commands/map.rs`     | Map command implementation     |
| `cli/src/commands/migrate.rs` | Migrate command implementation |

---

## Audit History

| Date   | Version   | Status  | Changes     |
|--------|-----------|---------|-------------|
| [DATE] | [VERSION] | Initial | First audit |