# ACP JSON Schemas

This directory contains the official JSON Schema definitions for all ACP file formats.

## Schemas

| Schema | File Pattern | Description |
|--------|--------------|-------------|
| [cache.schema.json](v1/cache.schema.json) | `.acp.cache.json` | Indexed codebase metadata generated by `acp index` |
| [vars.schema.json](v1/vars.schema.json) | `.acp.vars.json` | Reusable context variables for AI expansion |
| [config.schema.json](v1/config.schema.json) | `.acp.config.json` | Project configuration for ACP tooling |
| [attempts.schema.json](v1/attempts.schema.json) | `.acp/acp.attempts.json` | Debug session tracking and attempt management |
| [sync.schema.json](v1/sync.schema.json) | `.acp/acp.sync.json` | Tool synchronization configuration |
| [primer.schema.json](v1/primer.schema.json) | `primer.json`, `*.primer.json` | Primer definitions for AI context bootstrapping |

## Usage

### In Your Editor

Most modern editors automatically fetch schemas from [JSON Schema Store](https://www.schemastore.org/). Once ACP schemas are registered, you'll get automatic validation and autocomplete for ACP files.

### Manual Schema Reference

Add a `$schema` property to your ACP files for explicit validation:

```json
{
  "$schema": "https://acp-protocol.dev/schemas/v1/config.schema.json",
  "version": "1.0.0",
  "include": ["src/**/*"]
}
```

### Programmatic Validation

```bash
# Using ajv-cli
npm install -g ajv-cli
ajv validate -s schemas/v1/cache.schema.json -d .acp.cache.json --spec=draft7

# Using check-jsonschema
pip install check-jsonschema
check-jsonschema --schemafile schemas/v1/cache.schema.json .acp.cache.json

# Using the ACP CLI
acp validate .acp.cache.json
```

## Versioning

Schemas follow the ACP specification version. Breaking changes require a major version bump.

```
schemas/
├── v1/          # ACP 1.x schemas
├── v2/          # (future) ACP 2.x schemas
└── meta/        # Meta-schemas for annotation validation
```

## Schema Store Registration

These schemas are registered with [JSON Schema Store](https://www.schemastore.org/) for automatic editor support.

**Catalog entries** (for reference when updating Schema Store):

```json
{
  "name": "ACP Cache",
  "description": "AI Context Protocol cache file containing indexed codebase metadata for AI assistants",
  "fileMatch": [".acp.cache.json", "*.acp.cache.json", ".acp/acp.cache.json"],
  "url": "https://acp-protocol.dev/schemas/v1/cache.schema.json"
}
```

```json
{
  "name": "ACP Variables",
  "description": "AI Context Protocol variables file defining reusable context snippets",
  "fileMatch": [".acp.vars.json", "*.acp.vars.json", ".acp/acp.vars.json"],
  "url": "https://acp-protocol.dev/schemas/v1/vars.schema.json"
}
```

```json
{
  "name": "ACP Config",
  "description": "AI Context Protocol configuration file for indexing and behavior settings",
  "fileMatch": [".acp.config.json", "acp.config.json"],
  "url": "https://acp-protocol.dev/schemas/v1/config.schema.json"
}
```

```json
{
  "name": "ACP Attempts",
  "description": "AI Context Protocol debug session tracking file",
  "fileMatch": [".acp/acp.attempts.json", "acp.attempts.json"],
  "url": "https://acp-protocol.dev/schemas/v1/attempts.schema.json"
}
```

```json
{
  "name": "ACP Sync",
  "description": "AI Context Protocol tool synchronization configuration",
  "fileMatch": [".acp/acp.sync.json", "acp.sync.json"],
  "url": "https://acp-protocol.dev/schemas/v1/sync.schema.json"
}
```

```json
{
  "name": "ACP Primer",
  "description": "AI Context Protocol primer definition for AI context bootstrapping",
  "fileMatch": ["primer.json", "*.primer.json", "primer.defaults.json"],
  "url": "https://acp-protocol.dev/schemas/v1/primer.schema.json"
}
```

To update Schema Store registration, submit a PR to [SchemaStore/schemastore](https://github.com/SchemaStore/schemastore) modifying `src/api/json/catalog.json`.

## Validation Features

All ACP schemas support:

- **Draft-07 compliance**: Full JSON Schema Draft-07 support
- **Semantic validation**: Additional validation beyond schema (e.g., line ranges)
- **Cross-schema references**: Config schema references sync schema for embedded sync config
- **Pattern validation**: Strict patterns for version strings, hashes, and identifiers

## Testing

Schema validation is tested via:

1. **Unit tests**: Schema syntax and compile-time validation
2. **Integration tests**: Valid/invalid fixture validation
3. **CI/CD**: Automated validation on every push

Run tests locally:

```bash
cd cli
cargo test --test schema_validation
```

## Contributing

Schema changes require an RFC. See [/rfcs/README.md](/rfcs/README.md) for the proposal process.
